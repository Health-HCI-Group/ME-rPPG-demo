<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ME-rPPG Web Inference Demo</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.15.0/vconsole.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="./main.js"></script>
</head>
<body>
    <video id="videoInput" playsinline muted></video>
    <div id="container">
        <div id="sidebar">
            <div id="description">
                <div id="title">ME-rPPG Web Inference Demo</div>
                <div class="teaser-container">
                    <div class="teaser-image">
                        <img src="pic0.png" alt=""/>
                    </div>
                    <div>
                        <div>
                            This web interface is built upon the following open-source work, with its GitHub repository linked below.
                        </div>
                        <div style="padding: 0.2rem 0;">
                            <a href="https://github.com/KegangWangCCNU/ME-rPPG">
                                https://github.com/KegangWangCCNU/ME-rPPG
                            </a>
                        </div>
                        <div>
                            The model employs State Space Duality (SSD) from Mamba-2 to achieve both training efficiency and inference efficiency. During the inference phase, it utilizes a step-by-step inference approach that reduces memory consumption to just 4MB and decreases CPU operation latency to 10ms for the first time. This breakthrough enables local inference within web browsers without requiring GPUs.
                        </div>
                    </div>
                </div>
            </div>
            <div id="controlPanel">
                <div id="controlParams">
                    <div id="lambdaInput">
                        <span>Half-life of the state of temporal normalization</span>
                        <input id="lambdaValue" name="half-life" type="range" min="-0.477" max="0.477" value="0" step="0.001" list="tickmarks" />
                        <datalist id="tickmarks">
                            <option value="-0.477" label="1/3"></option>
                            <option value="0" label="1"></option>
                            <option value="0.477" label="3"></option>
                        </datalist>
                        <label for="lambdaValue">Î» = </label>
                        <span id="lambdaValueDisplay" class="numeralValue">1.000</span>
                    </div>
                </div>
                <button id="switchButton">Start</button>
            </div>
        </div>
        <div id="viewPanel">
            <div id="textDisplay">
                <div id="cameraDisplay">
                    <div id="previewTitle">
                        <div id="debugInfo">
                            <div class="status-bar">
                                <div>
                                    <span class="metric-label">Heart Rate:</span>
                                    <span class="value-box">
                                        <span id="heartRateValue" class="numeralValue">NaN</span>
                                    </span>
                                    <span class="unit">BPM</span>
                                </div>
                                <div>
                                    <span class="metric-label">Inference FPS:</span>
                                    <span class="value-box">
                                        <span id="inferenceFpsValue" class="numeralValue">0.0</span>
                                    </span>
                                </div>
                                <div>
                                    <span class="metric-label">Inference Delay:</span>
                                    <span class="value-box">
                                        <span id="inferenceDelayValue" class="numeralValue">NaN</span>
                                    </span>
                                    <span class="unit">ms</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="video-wrapper">
                    <div class="canvas-wrapper" style="position: relative;">
                        <canvas id="previewCanvas"
                                style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                        <canvas id="overlayCanvas"
                                style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                      </div>
                    </div>
                </div>
            </div>
            <div id="cameraPreview">
                <div id="resultPlot">
                    <div id="plot">
                        <div id="plotContainer">
                            <div id="plotContent">
                                <canvas id="plotCanvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="image-container">
        <div class="image-wrapper">
            <img src="pic1.png" alt="" />
        </div>
        <div class="image-wrapper">
            <a href="https://pi.cs.tsinghua.edu.cn/">
                <img src="pic2.png" alt="" />
            </a>
        </div>
    </div>
</body>
</html>
